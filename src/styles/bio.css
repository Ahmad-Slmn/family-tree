/* ================== bio.css — المودال + السيرة + القصص والمذكّرات ================== */

/* ================== النافذة العامة (المودال) ================== */
.modal{
  position:fixed;inset:0;background:var(--modal-overlay);backdrop-filter:blur(.5rem);
  display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;
  transition:opacity .8s,visibility .8s;z-index:1000
}
.modal.active{opacity:1;visibility:visible}

.modal-content{
  background:var(--modal-bg);color:var(--modal-fg);
  border:.0625rem solid var(--modal-border);
  border-radius:1.5rem;
  width:90%;max-width:31.25rem;max-height:85vh;overflow-y:auto;
  transform:translateY(1.875rem) scale(.95);
  opacity:0;transition:all .4s ease;
  box-shadow:var(--modal-shadow);
}
.modal.active .modal-content{transform:translateY(0) scale(1);opacity:1}

.modal-header{
  padding:1.5rem;border-bottom:.0625rem solid var(--surface-border);
  display:flex;justify-content:space-between;align-items:center;
  background:var(--header-bg);color:var(--title-color)
}
.modal-header h2,.modal-header .role{font-size:1.5rem;margin:0}

/* زر الإغلاق داخل مودال السيرة */
.close-button{
  background:var(--card-bg);border:0;width:2.5rem;height:2.5rem;border-radius:50%;
  font-size:1.5rem;cursor:pointer;color:var(--text-main);
  display:flex;justify-content:center;align-items:center;
  transition:background .2s,color .2s
}
.close-button:hover{background:var(--chip-bg);color:var(--title-color)}

/* شريط اختيار وضع السيرة */
.bio-mode-bar{
  display:flex;align-items:center;justify-content:space-between;gap:.75rem;
  margin:.35rem 0 1rem;padding:.55rem .9rem;
  background:var(--panel-bg);border:.0625rem solid var(--surface-border);
  border-radius:.85rem;box-shadow:0 .15rem .45rem rgba(0,0,0,.05);
  font-size:.92rem
}

/* شريط الروابط السريعة أعلى السيرة */
.bio-shortcuts{
  display:flex;flex-wrap:wrap;gap:.4rem;
  margin:.25rem .30rem .85rem
}
.bio-shortcut-btn{
  outline:none;padding:.25rem .7rem;border-radius:999px;
  background:color-mix(in oklab,var(--panel-bg) 90%,#fff);
  border:.0625rem solid color-mix(in oklab,var(--surface-border) 85%,transparent);
  font-size:.83rem;display:inline-flex;align-items:center;gap:.35rem;
  cursor:pointer;color:var(--text-main);
  box-shadow:0 .1rem .28rem rgba(0,0,0,.04);
  transition:background .15s,border-color .15s,transform .12s
}
.bio-shortcut-btn:hover{
  background:color-mix(in oklab,var(--ctl-hover-bg) 72%,#fff);
  border-color:color-mix(in oklab,var(--title-color) 40%,var(--surface-border));
  transform:translateY(-1px)
}
.bio-shortcut-btn--active{
  background:color-mix(in oklab,var(--modal-primary) 26%,var(--card-bg));
  border-color:color-mix(in oklab,var(--modal-primary) 78%,var(--surface-border));
  color:color-mix(in oklab,var(--modal-primary) 90%,var(--title-color));
  box-shadow:0 .16rem .45rem rgba(0,0,0,.12);
  transform:none;font-weight:600
}
.bio-shortcut-btn--active:hover{
  background:color-mix(in oklab,var(--modal-primary) 34%,var(--card-bg));
  border-color:color-mix(in oklab,var(--modal-primary) 86%,var(--surface-border))
}
.bio-shortcut-btn--active .bio-shortcut-badge{
  border-color:color-mix(in oklab,var(--modal-primary) 70%,transparent)
}
.bio-shortcut-label{white-space:nowrap}
.bio-shortcut-badge{
  min-width:1.4rem;padding:.05rem .4rem;border-radius:999px;
  font-size:.75rem;text-align:center;
  background:color-mix(in oklab,var(--badge-bg, var(--accent-soft, var(--panel-bg))) 82%,#fff);
  color:color-mix(in oklab,var(--title-color) 78%,var(--text-main));
  border:.0625rem solid color-mix(in oklab,var(--ancestor-border) 80%,transparent)
}

/* زر طي/فتح القوائم الطويلة */
.bio-list-toggle{
  margin:.35rem 0 0;padding:.18rem .7rem;border-radius:999px;
  border:.0625rem dashed color-mix(in oklab,var(--surface-border) 85%,transparent);
  background:color-mix(in oklab,var(--panel-bg) 94%,#fff);
  font-size:.8rem;cursor:pointer;align-self:flex-start;
  color:color-mix(in oklab,var(--title-color) 76%,var(--text-main))
}
.bio-list-toggle:hover{background:color-mix(in oklab,var(--panel-bg) 88%,#fff)}

.bio-mode-label-wrap{
  display:flex;align-items:center;gap:.4rem;color:var(--title-color);
  font-weight:600;white-space:nowrap
}
.bio-mode-label-wrap i{font-size:.9rem;opacity:.85}
.bio-mode-bar label{cursor:pointer}
.bio-mode-select-wrap{position:relative;min-width:10rem;max-width:14rem;flex:0 0 auto}
.bio-mode-select-wrap select{
  width:100%;appearance:none;-webkit-appearance:none;-moz-appearance:none;
  border-radius:.6rem;border:.0625rem solid var(--surface-border);background:var(--card-bg);
  padding:.35rem .7rem;padding-inline-end:.50rem;
  font-size:.9rem;color:var(--text-main);
  outline:none;box-shadow:0 .1rem .25rem rgba(0,0,0,.03);cursor:pointer;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  transition:border-color .16s,box-shadow .16s,background-color .16s
}
.bio-mode-select-wrap::after{
  content:"\f0d7";font-family:"Font Awesome 7 Free";font-weight:900;
  position:absolute;inset-inline-end:.55rem;top:50%;transform:translateY(-50%);
  font-size:.7rem;pointer-events:none;
  color:color-mix(in oklab,var(--title-color) 60%,transparent)
}
.bio-mode-select-wrap select:hover{
  border-color:color-mix(in oklab,var(--title-color) 50%,var(--surface-border));
  background:color-mix(in oklab,var(--card-bg) 90%,#fff)
}
.bio-mode-select-wrap select:focus-visible{
  border-color:var(--modal-primary);
  box-shadow:0 0 0 .09rem color-mix(in oklab,var(--modal-primary) 50%,transparent)
}
@media(max-width:40rem){
  .bio-mode-bar{flex-direction:column;align-items:stretch;gap:.5rem}
  .bio-mode-label-wrap{justify-content:flex-start}
  .bio-mode-select-wrap{width:100%;max-width:none}
}

/* ================== أقسام السيرة داخل المودال ================== */
.bio-sections{display:flex;flex-direction:column;gap:.9rem;margin-block:.5rem 1rem}

.bio-section{
  background:var(--card-bg);border:.0625rem solid var(--surface-border);border-radius:.9rem;
  padding:.65rem .9rem .8rem;color:var(--text-main);line-height:1.7;
  box-shadow:0 .25rem .6rem rgba(0,0,0,.04)
}

/* قسم البيانات الأساسية */
.bio-section[data-section-id="basic"]{
  background:linear-gradient(135deg,color-mix(in oklab,var(--ancestor-bg) 78%,#fff) 0%,var(--card-bg) 65%);
  border-color:var(--ancestor-border)
}
.bio-section[data-section-id="basic"] .bio-section-body{
  display:flex;flex-direction:column;gap:.35rem;padding-top:.3rem
}

/* ترويسة داخل البيانات الأساسية */
.bio-basic-header{
  display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:space-between;
  gap:.55rem;padding:.15rem .15rem .25rem
}
.bio-basic-main{display:flex;flex-direction:column;gap:.1rem;min-width:0}
.bio-basic-name{font-weight:700;font-size:1rem;color:var(--title-color)}
.bio-basic-cognomen{font-size:.85rem;opacity:.85}
.bio-basic-badges{display:flex;flex-wrap:wrap;gap:.25rem;align-items:center;justify-content:flex-end}
.bio-basic-badge{
  padding:.08rem .55rem;border-radius:999px;font-size:.78rem;
  border:.0625rem solid color-mix(in oklab,var(--surface-border) 85%,transparent);
  background:color-mix(in oklab,var(--panel-bg) 92%,#fff);
  white-space:nowrap
}
.bio-basic-badge--role{color:color-mix(in oklab,var(--title-color) 78%,var(--text-main))}
.bio-basic-badge--alive{
  color:color-mix(in oklab,var(--modal-primary) 80%,var(--text-main));
  background:color-mix(in oklab,var(--modal-primary) 10%,transparent)
}
.bio-basic-badge--dead{
  color:var(--modal-danger);
  background:color-mix(in oklab,var(--modal-danger) 12%,transparent)
}

/* تلميح المصادر */
.bio-field--sourcesHint span{display:inline-flex;align-items:center;gap:.35rem;flex-wrap:wrap}
.bio-link-btn{
  border:none;border-radius:999px;padding:.12rem .7rem;font-size:.8rem;cursor:pointer;
  background:color-mix(in oklab,var(--ctl-bg) 88%,#fff);
  color:color-mix(in oklab,var(--ctl-fg) 90%,var(--title-color));
  box-shadow:0 .08rem .25rem rgba(0,0,0,.05)
}
.bio-link-btn:hover{background:color-mix(in oklab,var(--ctl-hover-bg) 82%,#fff)}

.bio-section[data-section-id="basic"] .bio-field{
  width:fit-content;display:flex;justify-content:flex-start;gap:.5rem;padding:.15rem .35rem
}
.bio-section[data-section-id="basic"] .bio-field strong{
  flex:0 0 6.5rem;min-width:6.5rem;text-align:start;color:var(--title-color)
}
.bio-section[data-section-id="basic"] .bio-field span{flex:1 1 auto}

/* ملخص النسب */
.bio-field--relSummary span{
  font-size:.9rem;line-height:1.6;padding:.2rem .7rem;border-radius:.75rem;
  background:color-mix(in oklab,var(--accent-soft, var(--panel-bg)) 24%,var(--panel-bg));
  color:color-mix(in oklab,var(--title-color) 72%,var(--text-main));
  border:.0625rem solid color-mix(in oklab,var(--ancestor-border) 80%,transparent);
  display:inline-flex;align-items:center;gap:.35rem;
  box-shadow:var(--shadow-soft,0 .06rem .18rem rgba(0,0,0,.05))
}
.bio-section[data-section-id="basic"] .bio-field .age-dead,
.bio-section[data-section-id="basic"] .bio-field .age-alive{display:inline-block;text-align:center}

/* رأس القسم */
.bio-section-header{
  display:flex;align-items:center;justify-content:space-between;gap:.4rem;
  padding:.25rem .1rem .45rem;font-size:.98rem;font-weight:700;
  color:var(--title-color);background:transparent;border:0;cursor:pointer;text-align:start
}
.bio-section[data-section-id="basic"] .bio-section-header{
  cursor:default;justify-content:flex-start;
  border-bottom:.125rem solid color-mix(in oklab,var(--title-color) 70%,transparent);
  margin-bottom:.35rem;padding:.3rem .1rem .65rem;
  font-size:1.05rem;font-weight:800
}
.bio-section-title{letter-spacing:.01em}
.bio-section-toggle{font-size:.78rem;opacity:.8}

/* جسم الأقسام */
.bio-section-body{display:flex;flex-direction:column;gap:.4rem;padding-top:.3rem}
.bio-section:not([data-section-id="basic"]) .bio-section-body{
  border-top:.0625rem dashed var(--section-divider-strong);margin-top:.45rem;padding-top:.55rem
}

/* وصف عام */
.bio-description{margin:.625rem 0}
.bio-info{
  background:var(--panel-bg);padding:.6rem .7rem;border-radius:.85rem;
  display:flex;flex-direction:column;gap:.35rem
}

/* الحقول الافتراضية */
.bio-field{display:flex;align-items:flex-start;gap:.3rem;font-size:.95rem}
.bio-field strong{
  color:var(--title-color);font-weight:700;
  flex:0 0 7.25rem;min-width:7.25rem;text-align:start
}
.bio-field span{flex:1 1 auto}

/* نص الملاحظة */
.bio-field--remark span{
  font-size:.9rem;line-height:1.6;padding:.18rem .6rem;border-radius:.6rem;
  background:color-mix(in oklab,var(--badge-bg) 90%,#fff);
  color:color-mix(in oklab,var(--modal-danger) 32%,var(--text-main));
  border:.0625rem dashed color-mix(in oklab,var(--modal-danger) 65%,transparent);
  display:inline-block;
  box-shadow:0 0 0 .0625rem color-mix(in oklab,var(--badge-bg) 70%,transparent)
}

/* العمر */
.age-alive{color:color-mix(in oklab,var(--modal-primary) 70%,var(--modal-fg));font-weight:500}
.age-dead{
  color:var(--modal-danger);font-weight:600;
  background:color-mix(in oklab,var(--modal-danger) 16%,transparent);
  padding:.12rem .5rem;border-radius:.4rem
}

/* عناوين فرعية */
.bio-section h3{color:var(--title-color);margin:.3rem 0 .45rem;font-size:.96rem}

/* قوائم الأقسام */
.bio-section ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:.45rem}
.bio-section li{
  background:var(--list-item-bg);
  border:.0625rem solid var(--surface-border);
  padding:.5rem .9rem;border-radius:.55rem;font-size:.93rem;
  color:var(--text-main);
  transition:background .2s,color .2s,transform .16s
}
.bio-section li:hover{background:var(--ctl-hover-bg);color:var(--ctl-fg);transform:translateY(-1px)}

/* ملخّص الأحفاد */
.bio-grandkids-summary{
  margin:.25rem 0 .4rem;padding:.35rem .65rem;border-radius:.7rem;
  background:color-mix(in oklab,var(--panel-bg) 90%,#fff);
  border:.0625rem dashed color-mix(in oklab,var(--surface-border) 85%,transparent);
  font-size:.9rem;color:var(--title-color);
  display:inline-flex;align-items:center;gap:.35rem
}

/* تقليل الزحمة للإخوة/الأخوات */
.bio-sublist ul{list-style:none;padding:0;margin:.25rem 0}
.bio-sublist li.bio-li{
  padding:.55rem .8rem;margin:.35rem 0;
  border:.0625rem solid var(--ancestor-border);border-radius:.75rem;
  line-height:1.55;display:flex;flex-direction:column;gap:.2rem;white-space:normal
}
.bio-sublist li.bio-li .sib-name{font-weight:700;font-size:1rem}
.bio-sublist li.bio-li .sib-meta{font-size:.85rem;opacity:.8}

/* الهوايات */
.hobbies{display:flex;flex-wrap:wrap;gap:.5rem}
.hobby{
  background:var(--chip-bg);color:var(--title-color);
  padding:.45rem 1rem;border-radius:1rem;font-weight:600;font-size:.88rem
}

/* رؤوس الأقسام الثابتة */
.bio-section-header-static{cursor:default}

/* ================== ترويسة السيرة بصورة ================== */
.bio-photo{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}
.avatar-lg{
  width:4.5rem;height:4.5rem;border-radius:50%;overflow:hidden;
  flex:0 0 auto;border:.0625rem solid var(--ancestor-border)
}
.avatar-lg img{width:100%;height:100%;object-fit:cover;display:block}
.bio-head .bio-name{font-weight:700;font-size:1.05rem;color:var(--title-color)}
.bio-head .bio-role{opacity:.8;font-size:.9rem}

/* ترويسة السيرة + الصورة العلوية */
.bio-header{
  position:relative;
  display:flex;flex-direction:column;align-items:center;
  padding:1rem .75rem .9rem;gap:.75rem
}
.bio-header .close-button{position:absolute;inset-inline-start:.75rem;top:.65rem;z-index:1}
.bio-header-inner{display:flex;flex-direction:column;align-items:center;flex:1;gap:.4rem;text-align:center}

/* تكبير الصورة العلوية قليلاً */
.bio-photo-top{
  width:8.5rem;height:8.5rem;border-radius:50%;overflow:hidden;
  border:.150rem solid var(--ancestor-border)
}
.bio-photo-top .avatar{
  width:8.5rem;height:8.5rem;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:3rem;line-height:1;
  background:var(--avatar-bg);
  border:.125rem solid var(--ancestor-border);overflow:hidden
}
.bio-photo-top img{width:100%;height:100%;object-fit:cover;display:block;cursor:pointer}

/*================== قسم الصورة: طبقة المودال (قص/تمركز) + أدوات التحكم (تدوير/قلب) ================== */
.photo-box--relative{position:relative}

.photo-modal-layer{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:9999}
.photo-modal-card{background:#fff;padding:12px;border-radius:10px;max-width:90vw;max-height:90vh}
.photo-modal-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
.photo-modal-body{max-width:80vw;max-height:75vh;overflow:hidden}
.photo-modal-img{max-width:100%;display:block}

.photo-tools{display:flex;gap:.4rem;margin-top:.5rem;flex-wrap:wrap;align-items:center}
.free-rotate-wrap{display:inline-flex;gap:.35rem;align-items:center}
.free-rotate-label{font-size:.78rem}
.free-rotate-range{width:120px}
.free-rotate-val{min-width:2.2rem;text-align:center;font-size:.78rem}

/* ================== مؤشر انشغال الصورة ================== */
#bioPhoto.is-photo-busy{pointer-events:none;user-select:none}

#bioPhoto .photo-busy-overlay{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  padding:.75rem;
  background:color-mix(in oklab, var(--modal-overlay) 55%, transparent);
  backdrop-filter:blur(.35rem);
  border-radius:inherit;
  z-index:50
}
#bioPhoto .photo-busy-card{
  display:flex;align-items:center;gap:.65rem;
  padding:.55rem .85rem;border-radius:999px;
  background:color-mix(in oklab, var(--card-bg) 86%, #fff);
  border:.0625rem solid color-mix(in oklab, var(--surface-border) 80%, transparent);
  box-shadow:0 .35rem 1rem rgba(0,0,0,.10);
  color:var(--text-main)
}
#bioPhoto .photo-busy-text{display:flex;flex-direction:column;gap:.05rem;line-height:1.2}
#bioPhoto .photo-busy-title{font-weight:800;font-size:.9rem;color:var(--title-color)}
#bioPhoto .photo-busy-sub{font-size:.78rem;opacity:.85}
#bioPhoto .photo-busy-spinner{
  width:1.125rem;height:1.125rem;border-radius:50%;
  border:.125rem solid color-mix(in oklab, var(--surface-border) 70%, transparent);
  border-top-color:color-mix(in oklab, var(--modal-primary) 85%, var(--title-color));
  animation:photoBusySpin .75s linear infinite
}
@keyframes photoBusySpin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

.bio-identity{display:flex;flex-direction:column;align-items:center;text-align:center;gap:.45rem;width:100%}
#bioTools{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.35rem;justify-content:center}
.bio-divider{
  width:100%;border:0;height:.0625rem;
  background:var(--section-divider-strong,
    var(--section-divider,
      var(--surface-border, color-mix(in srgb, var(--text-main) 28%, transparent))));
  margin:.25rem 0 0
}
.bio-actions{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:.5rem;width:100%}

/* ================== استجابة للشاشات ================== */
@media (max-width:23.9rem){
  .modal{align-items:stretch}
  .modal-content{width:100%;max-width:none;min-height:100vh;max-height:100vh;border-radius:0}
}
@media (min-width:24rem) and (max-width:29.9rem){
  .modal-content{width:96%;max-width:27rem;max-height:92vh;border-radius:1.25rem}
}
@media (min-width:30rem) and (max-width:39.9rem){
  .modal-content{width:94%;max-width:34rem;max-height:90vh}
}
@media (min-width:40rem) and (max-width:47.9rem){
  .modal-content{width:90%;max-width:40rem;max-height:88vh}
}
@media (min-width:48rem) and (max-width:63.9rem){
  .modal-content{width:82%;max-width:46rem;max-height:86vh}
}
@media (min-width:64rem){
  .modal-content{width:70%;max-width:50rem;max-height:85vh}
}
