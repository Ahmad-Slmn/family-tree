/* ================== tree.css — شجرة العائلة والبطاقات والموصلات ================== */

/* ================== تخطيط شجرة العائلة ================== */
.family-tree{
  display:flex;flex-direction:column;align-items:center;
  gap:3rem;padding:2rem
}
.generation{
  display:flex;flex-wrap:wrap;justify-content:center;gap:2rem;
  position:relative;width:100%
}

.tree-tools-wrap{
  display: flex;justify-content: center;align-items: center;
  flex-wrap: wrap;gap: 1rem;margin-block-end: .6rem;
}

.mother-toggle{
  display:flex;align-items:center;justify-content:center;gap:.5rem;
  padding:.4rem .6rem;border-radius:.5rem;
  border:1px solid var(--section-divider-strong);
  background:color-mix(in srgb,var(--panel-bg) 85%,#fff);
  color:var(--text-main);
}
.results-count{
  padding:.4rem .6rem;border-radius:.5rem;font-weight:600;
  background:color-mix(in srgb,var(--panel-bg) 90%,#fff);
  color:var(--title-color);
}

/* الزوجة ككرت مرن يتجاوب مع العرض */
.wife-section{
  display:flex;flex-direction:column;align-items:center;
  padding:1rem;background:var(--card-bg);
  border:1px solid var(--surface-border);border-radius:1rem;
  flex:1 1 16rem;max-width:20rem;height:fit-content
}

.wife-section-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  width:100%;
  margin-bottom:.5rem;
}
.wife-section-title{
  font-weight:600;
  font-size:.95rem;
  color:var(--title-color);
}
.wife-section-toggle{
  font-size:.8rem;
  padding:.15rem .6rem;
  border-radius:999px;
  border:1px solid var(--surface-border);
  background:color-mix(in srgb,var(--panel-bg) 92%,#fff);
  color:var(--text-main);
  cursor:pointer;
}
.wife-section-toggle:hover{
  filter:brightness(1.05);
}
.wife-section-body.is-collapsed{
  display:none;
}

.children-grid{display:grid;gap:1.5rem}

/* عدادات */
.wife-counter,.grandson .sibling-counter,.grandson .wife-count,.grandson .Create_Children_CountBox{
  position:absolute;top:0;padding:.375rem .875rem;font-size:.8125rem;font-weight:bold;z-index:10
}
.wife-counter{right:-.25rem;text-align:right}
.grandson .sibling-counter{left:-.25rem;text-align:left}
.grandson .wife-count{right:-.25rem}
.grandson .Create_Children_CountBox{top:1.5rem;right:-.25rem;text-align:right}
.grandson .Create_Children_CountBox>p,.grandson .sibling-counter>p{padding-bottom:.2rem}
.grandson .Create_Children_CountBox .label,.grandson .sibling-counter>p,.grandson .wife-count>p{color:var(--title-color)}
.grandson .Create_Children_CountBox .value,.grandson .sibling-counter strong,.grandson .wife-count .value{color:var(--text-main)}
.wife-number{
  position:absolute;top:0;left:50%;transform:translateX(-50%);width:1.5rem;height:1.5rem;
  background:var(--ancestor-bg);border:.125rem solid var(--connector-color);color:var(--title-color);
  border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600
}

/* ================== بطاقات الأعضاء ================== */
.member-card{
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  width:19rem;
  min-height:19rem;
  padding:1.5rem 1.25rem;
  text-align:center;
  border-radius:1rem;
  cursor:pointer;
  border:1px solid var(--surface-border);
  box-shadow:0 .25rem .375rem rgba(0,0,0,.1);
  transition:transform .3s cubic-bezier(.4,0,.2,1),
             box-shadow .3s cubic-bezier(.4,0,.2,1);
  gap:.75rem;
  z-index: 1
}
.member-card:hover{
  transform:translateY(-.3125rem);
  box-shadow:0 .75rem 1.25rem rgba(0,0,0,.15);
}

/* ألوان حسب النوع */
.member-card.ancestor{border:.125rem solid var(--ancestor-border);background:var(--card-bg);}
.member-card.wife{background:var(--wife-bg);}
.member-card.son{background:var(--son-bg);}
.member-card.daughter{background:var(--daughter-bg);}

/* الصورة / الأفتار */
.member-card>.avatar{
  width:5.25rem;
  height:5.25rem;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0;
  font-size:2.5rem;
  border-radius:50%;
  overflow:hidden;
  border:2px solid var(--ancestor-border);
  box-shadow:0 0 0 2px var(--card-bg);
  background:var(--avatar-bg);
  z-index: 1
}
.member-card>.avatar>img{
  display:block;
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:50%;
}

/* ألوان الأفتار لكل دور */
.member-card.ancestor>.avatar{background:var(--ancestor-bg);color:#d97706;}
.member-card.wife>.avatar{background:#ffe4e6;color:#e11d48;}
.member-card.son>.avatar{background:#e0f2fe;color:#0369a1;}
.member-card.daughter>.avatar{background:#f3e8ff;color:#7e22ce;}

/* هوية الشخص (الاسم + الدور + تاريخ الميلاد) */
.member-card>.identity-fields{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  gap:.4rem;
  margin-top: 1rem;
}

/* الاسم */
.member-card>.identity-fields>.name{
  margin-block:.15rem;
  font-weight:700;
  font-size:1rem;
  color:var(--title-color);
  cursor:text;
}

/* حقل قابل للتحرير داخل الاسم */
.editable-inline{
  display:inline;
  width:fit-content;
  border:1px solid transparent;
  border-radius:.35rem;
  line-height:1.25;
  outline:0;
  background:rgba(0,0,0,.02);
  user-select:text;
  -webkit-user-modify:read-write-plaintext-only;
  transition:border-color .15s ease,
             box-shadow .15s ease,
             background-color .15s ease;
}
.editable-inline:focus{
  background:var(--card-bg);
  border-color:var(--focus-border);
  box-shadow:0 0 0 3px var(--focus-ring-soft);
}
.editable-inline:empty::before{
  content:attr(data-placeholder);
  color:var(--placeholder-fg);
  font-weight:400;
}
.editable-inline[contenteditable="true"][aria-invalid="true"]{
  border-color:var(--modal-danger);
  box-shadow:0 0 0 3px color-mix(in srgb,var(--modal-danger) 25%,transparent);
}

/* الشارة (الدور: ابن/بنت/زوجة/...) */
.member-card>.identity-fields>.role{
  display:inline-block;
  padding:.25rem .75rem;
  border-radius:1rem;
  font-size:.875rem;
  font-weight:700;
  color:var(--role-fg);
  background:var(--role-bg);
}

/* سطر الأم أسفل البطاقة */
.member-card .mini-strip{
  margin-top:auto;
  width:100%;
  text-align:center;
  font-size:.8rem;
  opacity:.9;
  padding-top:.45rem;
  border-top:1px dashed color-mix(in oklab,var(--surface-border) 60%,transparent);
}
.member-card .mini-strip span{opacity:.9;}
.member-card .mini-strip strong{font-weight:600;}
/* سطر المسار العائلي في نتائج البحث */
.member-card .search-lineage{
  margin-top:.35rem;
  font-size:.8rem;
  opacity:.85;
  direction:rtl;
}

/* عدادات جانبية على البطاقة */
.counter-box{
  position:absolute;top:.35rem;inset-inline:.35rem;
  display:flex;justify-content:space-between;align-items:flex-start;
  gap:.75rem;pointer-events:none;

}

/* شارة مصدر المطابقة في نتائج البحث */
.search-match-badge{
  position:absolute;
  bottom:.4rem;
  inset-inline-start:.6rem;
  padding:.15rem .6rem;
  border-radius:999px;
  font-size:.75rem;
  font-weight:600;
  background:var(--badge-bg);
  color:var(--title-color);
  box-shadow:0 0 .35rem rgba(0,0,0,.15);
}

.counter-right,
.counter-left{position:static;display:flex;flex-direction:column;}
.counter-right{align-items:flex-start;text-align:start;}
.counter-left{align-items:flex-end;text-align:end;}
.count-item{display:flex;gap:.3rem;align-items:center;margin-bottom:.3rem;font-size:.9rem;font-weight:bold;}
.count-label{color:var(--title-color);}
.count-value{
  padding:.2rem;border-radius:1rem;min-width:1.8rem;
  background:var(--badge-bg);color:var(--text-main);text-align:center;
}

/* ================== الوصلات والسهام ================== */
.generation.ancestor-generation{
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  flex-wrap: nowrap;
  gap: 0 !important;
  width: auto;
}

/* دوائر بداية/نهاية الموصل */
.ancestor-generation > .connector::before,
.ancestor-generation > .connector::after{
  content:"";position:absolute;left:50%;transform:translateX(-50%);inline-size: 0;
  block-size: 0;background: transparent;border: none;
  box-shadow:0 0 .5rem color-mix(in oklab,var(--connector-color) 70%,transparent);
}
.ancestor-generation > .connector::before{ top: calc(var(--ancestor-dot) / -2); }
.ancestor-generation > .connector::after { bottom: calc(var(--ancestor-dot) / -2); }

/* تحريك البطاقة */
.ancestor-generation > .member-card:hover{
  transform: translateY(calc(var(--ancestor-lift) * -1));
}

/* القاعدة الأساسية للموصل */
.ancestor-generation > .connector{
  inline-size: var(--ancestor-line);
  block-size: var(--ancestor-gap);
  margin: 0 !important;
  background: linear-gradient(
    to bottom,
    color-mix(in oklab, var(--connector-color) 85%, #fff),
    var(--connector-color)
  );
  border-radius: 999px;
  box-shadow: 0 0 .6rem color-mix(in oklab,var(--connector-color) 70%,transparent);
  position: relative;
  transition:
    block-size .3s cubic-bezier(.4,0,.2,1),
    margin-top  .3s cubic-bezier(.4,0,.2,1);
}

/* الموصل الذي قبل البطاقة المرفوعة */
.ancestor-generation > .connector:has(+ .member-card:is(:hover,:focus-within,.is-lifted,.is-dragging)){
  block-size: calc(var(--ancestor-gap) - var(--ancestor-lift));
}

/* الموصل الذي بعد البطاقة المرفوعة */
.ancestor-generation > .member-card:is(:hover,:focus-within,.is-lifted,.is-dragging) + .connector{
  margin-top: calc(var(--ancestor-lift) * -1) !important;
  block-size: calc(var(--ancestor-gap) + var(--ancestor-lift));
}

/* لا تحرك الموصل عند hover عليه وحده */
.ancestor-generation > .connector:hover{
  transform:none;
  filter: brightness(1.08);
}

.family-tree:has(>.ancestor-generation){gap:0!important}
.family-tree>.generation:not(.ancestor-generation){margin-top:3rem}
.member-card.wife{overflow:visible}
.member-card.wife .wife-connector{
  position:absolute;left:50%;bottom:-1.25rem;
  transform:translateX(-50%);width:.125rem;height:1.25rem;
  background:var(--arrow-color);border-radius:999px
}
.member-card.wife .wife-connector::after{
  content:"";position:absolute;bottom:-.55rem;left:50%;
  transform:translateX(-50%);
  border-left:.375rem solid transparent;
  border-right:.375rem solid transparent;
  border-top:.55rem solid var(--arrow-color)
}
.wife-connector,.wife-connector *, .connector,.connector::before,.connector::after{
  pointer-events:none!important
}

/* الحاوية الرئيسية للشجرة في DOM */
#familyTree{position:relative;z-index:10}

/* تجاوب الشجرة والزوجات حسب العرض */
@media (max-width:23.9rem){
  .generation{flex-direction:column;align-items:stretch;gap:1.5rem}
  .wife-section{flex:1 1 100%;max-width:100%}
}
@media (min-width:24rem) and (max-width:29.9rem){
  .generation{justify-content:center;gap:1.75rem}
  .wife-section{flex:1 1 calc(50% - 1rem);max-width:22rem}
}
@media (min-width:30rem) and (max-width:39.9rem){
  .generation{justify-content:center;gap:2rem}
  .wife-section{flex:1 1 calc(50% - 1.2rem);max-width:23rem}
}
@media (min-width:40rem) and (max-width:47.9rem){
  .generation{justify-content:center;gap:2.25rem}
  .wife-section{flex:1 1 calc(50% - 1.5rem);max-width:24rem}
}
@media (min-width:48rem) and (max-width:63.9rem){
  .generation{justify-content:center;gap:2.5rem}
  .wife-section{flex:1 1 calc(33.333% - 1.5rem);max-width:24rem}
}
@media (min-width:64rem){
  .generation{flex-wrap:wrap;justify-content:center;gap:4rem}
  .wife-section{flex:0 1 18rem;max-width:20rem}
}
